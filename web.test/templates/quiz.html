<!DOCTYPE html>
<html>
<head>
  <title>仲間外れクイズ</title>
  <style>
    .image-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }

    .image-container img {
      width: 200px;
      height: 200px;
      margin: 10px;
      cursor: pointer;
      border: 2px solid transparent;
    }

    /* 選んだやつの外枠 */
    .image-container img.selected {
      border-color: blue;
      border-width: 4px; /* 外枠の太さを4pxに設定 */
      border-style: solid; /* 外枠のスタイルを実線に設定 */
    }

    /* 正解の時の外枠 */
    .image-container img.correct {
        border-color: red;
        border-width: 8px; /* 外枠の太さを4pxに設定 */
        border-style: solid; /* 外枠のスタイルを実線に設定 */
    }

    #result {
      text-align: center;
      font-weight: bold;
      font-size: 24px;
    }

    h1 {
      text-align: center;
    }

    #next-btn {
      display: none; /* 初期状態では非表示 */
      margin-top: 20px;
      text-align: center;
    }


  </style>
</head>
<body>
  <h1>仲間外れを選んでください</h1>
  <div class="image-container">
    <!-- <img src="{{ url_for('static', filename='/imgs/image1.jpg') }}" onclick="checkAnswer(this)">
    <img src="{{ url_for('static', filename='/imgs/image2.jpg') }}" onclick="checkAnswer(this)">
    <img src="{{ url_for('static', filename='/imgs/image3.jpg') }}" onclick="checkAnswer(this)">
    <img src="{{ url_for('static', filename='/imgs/image4.jpg') }}" onclick="checkAnswer(this)"> -->
    {% for path in image_paths %}
    <img src="{{ url_for('static', filename=path) }}" onclick="checkAnswer(this)">
    {% endfor %}
  </div>
  <div id="result"></div>

  <div id="next-btn">
    <button onclick="showNextQuestion()">次へ</button>
  </div>

  <!-- <script>
    let correctAnswer = 3; // 正解の画像番号（0から始まる）

    function checkAnswer(img) {
      let images = document.querySelectorAll('.image-container img');
      images.forEach(img => {
        img.classList.remove('selected');
        img.onclick = null; // イベントハンドラを無効化
      });
    //   images.forEach(img => img.classList.remove('selected'));
      img.classList.add('selected');

      let selectedIndex = Array.from(images).indexOf(img);
      let result = document.getElementById('result');

      if (selectedIndex === correctAnswer) {
        result.textContent = '正解！';
      } else {
        result.textContent = '不正解...';
      }

    document.getElementById('next-btn').style.display = 'block';
    
    }

    function showNextQuestion() {
      // 次の問題に進むための処理をここに記述
      // 例: 画像を更新する、正解を変更する、など
      window.location.href = '/run_script';
    }

    
  </script> -->
  <script>
    let quizzes = {{ quizzes|tojson }};
    let currentQuizIndex = 0;
    let correctAnswer;
    let images;

    function loadQuiz() {
        let quiz = quizzes[currentQuizIndex];
        correctAnswer = quiz.correct_answer;
        let imageContainer = document.querySelector('.image-container');
        imageContainer.innerHTML = '';
        images = [];

        quiz.image_paths.forEach((path, index) => {
            let img = document.createElement('img');
            img.src = `{{ url_for('static', filename='') }}${path}`;
            img.onclick = () => checkAnswer(img);
            imageContainer.appendChild(img);
            images.push(img);
        });
    }

    loadQuiz();

    function checkAnswer(img) {
        // 既存の処理...
        images.forEach(img => {
            img.classList.remove('selected');
            img.onclick = null; // イベントハンドラを無効化
        });
        img.classList.add('selected');

        let selectedIndex = images.indexOf(img);
        let result = document.getElementById('result');

        if (selectedIndex === correctAnswer) {
            result.textContent = '正解！';
        } else {
            result.textContent = '不正解...';
        }

        images[correctAnswer].classList.add('correct');

        // 次に進むボタンの表示を制御
        if (currentQuizIndex === quizzes.length - 1) {
            // 最後のクイズの場合
            document.getElementById('next-btn').innerHTML = '<button onclick="redirectToRunScript()">結果を見る</button>';
        } else {
            document.getElementById('next-btn').innerHTML = '<button onclick="showNextQuestion()">次へ</button>';
        }
        document.getElementById('next-btn').style.display = 'block';
    }

    function showNextQuestion() {
        currentQuizIndex++;
        if (currentQuizIndex < quizzes.length) {
            loadQuiz();
            document.getElementById('result').textContent = ''; // 結果をクリア
            document.getElementById('next-btn').style.display = 'none'; // 次に進むボタンを非表示にする
            
            // 画像の選択状態をリセット
            images.forEach(img => {
                img.classList.remove('selected');
                img.onclick = () => checkAnswer(img); // イベントハンドラを再度有効化
            });
        } else {
            // すべてのクイズが終了した場合の処理
            window.location.href = '/run_script';
        }
    }

    function redirectToRunScript() {
        // /run_scriptに移動
        window.location.href = '/run_script';
    }
</script>

</body>
</html>
